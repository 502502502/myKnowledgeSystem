## 1、解释一下什么是CAP？

- Consistency：一致性就是在客户端任何时候看到各节点的数据都是一致的。
- Availability：可用性就是在任何时刻都可以提供读写。
- Partition Tolerance：分区容错性是在网络故障、某些节点不能通信的时候系统仍能继续工作。 具体地讲在分布式系统中，在任何数据库设计中，一个Web应用最多只能同时支持上面的两个属性。显然，任何横向扩展策略都要依赖于数据分区。因此，设计人员必须在一致性与可用性之间做出选择

AP（高可用&&分区容错）:

允许至少一个节点更新状态会导致数据不一致，即丧失了C性质（一致性）。会导致全局的数据不一致。

CP（一致&&分区容错）:

为了保证数据一致性，将分区一侧的节点设置为不可用，那么又丧失了A性质（可用性）。分区同步会导致同步时间无限延长（也就是等数据同步完成之后才能正常访问）

CA（一致&&高可用）:

两个节点可以互相通信，才能既保证C（一致性）又保证A（可用性），这又会导致丧失P性质（分区容错性）。这样的话就分布式节点受阻，无法部署子节点,放弃了分布式系统的可扩展性。因为分布式系统与单机系统不同，它涉及到多节点间的通讯和交互，节点间的分区故障是必然发生的，所以在分布式系统中分区容错性是必须要考虑的。



## 2、什么是分布式事务？

分布式事务就是指事务的参与者、支持事务的服务器、资源服务器以及事务管理器分别位于不同的分布式系统的不同节点之上，需要保证在每一个服务器上执行的操作全部成功或者全部失败，最终达到数据一致性。





## 3、了解BASE理论吗？

BASE理论指的是：

- Basically Available（基本可用）
- Soft state（软状态）
- Eventually consistent（最终一致性） BASE理论是对CAP中的一致性和可用性进行一个权衡的结果，是对互联网大规模分布式系统的实践总结，强调可用性。

理论的核心思想就是：基本可用（Basically Available）和最终一致性（Eventually consistent）。虽然无法做到强一致，但每个应用都可以根据自身的业务特点，采用适当的方式来使系统达到最终一致性（Eventual consistency）。



## 4、实现分布式事务一致性（Consistency）的方法有哪些?

> **两阶段提交协议**

二阶段提交协议（Two-Phase Commit）的核心是

引入了一个事务协调者（TC）
在真正的提交操作前， 增加了一个准备阶段， 收集业务结点是否有能力进行提交

<img src="https://ningct.oss-cn-hangzhou.aliyuncs.com/image-20230313120037179.png" alt="image-20230313120037179" style="zoom: 67%;" />

当 TC 收到 A 和 B 响应 “Yes” 后， 做出了 “commit” 的决定， 向 A /B 发送指令或， 并不需要再等待 A/B 的响应， 可以直接向 client 返回成功
之所以可以这样做的原因是， 当 A/B 返回 Yes 后， 就代表 A 和 B 都做好了提交准备， 只要 TC 决定要提交，即使 A/B 宕机， 没有收到 TC 的 Commit 指令， 只要 A/B 被修复重启， A 和 B 都必须有能力成功完成提交操作。

> 二阶段提交协议如何满足安全性（Safety）

- 事务协调者 TC，作为一个中心， 统一收集了 A 和 B 是否有意愿（有能力）进行 commit
- 事务协调者 TC 强制保证了， A， B 双方必须都有意愿提交时， 才进行 commit

> 二阶段提交存活性

- 存活性： 如果没有宕机和信息丢失， 提交肯定可以完成
- 存活性： 如果发生宕机和信息丢失， 只要最终修复， 并且重启， 等待足够长的时间， 最终一定可以达成某项一致的结果（abort 或者 commit）